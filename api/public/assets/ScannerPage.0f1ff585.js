import{R as p,S as c,W as x,u as s,at as R,r as d,a as V,a6 as B,T as h,ad as l,U as r,a8 as _,_ as N,aa as y,V as u,Z as P,as as W,X as $}from"./index.4fb94c5d.js";import{b as A,Q as F}from"./useNotify.5b600000.js";import{u as k,_ as M}from"./CardList.fc54f7bb.js";import Q from"./MainLayout.0022f6b1.js";import"./query.303e0433.js";import"./InputSearch.fe9a552f.js";import"./MainHeader.ed1d9488.js";const T=p({__name:"ScannerResults",setup(o){const t=k();return(i,a)=>(c(),x(M,{cards:s(t).scannedCards},null,8,["cards"]))}});var U="/assets/beep.8f62dcd8.mp3";function j(o){return R("/api/ocr/scan",{imageBase64:o})}function I(){return A({mutationFn:j})}const O={class:"scanner-window"},L={class:"scanned-text text-white"},q=p({__name:"ScannerWindow",setup(o){let t=null;const i=new Audio(U),a=d(null),n=d(null),S=/(android|iphone|ipad)/i.test(navigator.userAgent),{mutateAsync:b,isLoading:v}=I(),f=k(),w={audio:!1,video:S?{facingMode:{exact:"environment"}}:!0},C=V(()=>f.scannedCards.map(e=>e.frontFace.name).join(", "));function D(){navigator.mediaDevices.getUserMedia(w).then(e=>{a.value&&(a.value.srcObject=e,t=e)}).catch(e=>{console.error("Nelze z\xEDskat p\u0159\xEDstup k videu z kamery:",e)})}function E(){if(n.value&&a.value){n.value.width=a.value.videoWidth,n.value.height=a.value.videoHeight;const e=n.value.getContext("2d");return e?(e.filter="grayscale(100%)",e):(console.error("Nelze z\xEDskat kontext pro kreslen\xED na pl\xE1tno."),null)}}async function z(){if(!t||!a.value||!n.value){console.error("Video stream nen\xED dostupn\xFD.");return}try{const e=E();if(!e)return;e.drawImage(a.value,0,0,n.value.width,n.value.height);const m=n.value.toDataURL("image/jpeg"),g=await b(m);if(i.play(),!g){console.error("Cant get card from image.");return}f.addToScannedCards(g)}catch(e){alert(e)}}return D(),B(()=>{t&&t.getTracks().forEach(e=>e.stop())}),(e,m)=>(c(),h("div",O,[l("video",{ref_key:"videoRef",ref:a,autoplay:"",class:"video-scanner"},null,512),l("canvas",{ref_key:"canvasRef",ref:n,class:"hidden"},null,512),r(_,{onClick:z,round:"",disable:s(v),loading:s(v),size:"xl",color:"primary",icon:"camera",class:"photo-btn"},null,8,["disable","loading"]),l("div",L,N(C.value),1)]))}});var H=y(q,[["__scopeId","data-v-b73a75b8"]]);const X=p({__name:"ScannerPage",setup(o){const t=d(!0);return(i,a)=>(c(),x(Q,{"hide-search":""},{default:u(()=>[r(F,{class:"q-pa-sm"},{default:u(()=>[r(_,{color:"primary",class:"full-width",onClick:a[0]||(a[0]=n=>t.value=!0)},{default:u(()=>[P("Open Scanner")]),_:1}),r(s(T)),t.value?(c(),h(W,{key:0},[r(_,{class:"close-btn",color:"primary",round:"",flat:"",icon:"arrow_back_ios",size:"xl",onClick:a[1]||(a[1]=n=>t.value=!1)}),r(s(H))],64)):$("",!0)]),_:1})]),_:1}))}});var ne=y(X,[["__scopeId","data-v-5c07ba23"]]);export{ne as default};
