import{R as p,S as o,W as m,u as l,at as z,r as d,a as R,a6 as V,T as g,ad as i,U as r,a8 as _,_ as W,aa as x,V as u,Z as B,as as N,X as P}from"./index.de775ea6.js";import{b as $,Q as F}from"./useNotify.a08dbcce.js";import{u as h,_ as M}from"./CardList.39945fd4.js";import Q from"./MainLayout.330fcd43.js";import"./query.aea2148a.js";import"./InputSearch.696e9fad.js";import"./MainHeader.df75f8c2.js";const T=p({__name:"ScannerResults",setup(s){const n=h();return(t,a)=>(o(),m(M,{cards:l(n).scannedCards},null,8,["cards"]))}});var U="/assets/beep.8f62dcd8.mp3";function j(s){return z("/api/ocr/scan",{imageBase64:s})}function A(){return $({mutationFn:j})}const I={class:"scanner-window"},O={class:"scanned-text text-white"},q=p({__name:"ScannerWindow",setup(s){let n=null;const t=d(null),a=d(null),c=/(android|iphone|ipad)/i.test(navigator.userAgent),{mutateAsync:y}=A(),v=h(),k={audio:!1,video:c?{facingMode:{exact:"environment"}}:!0},S=R(()=>v.scannedCards.map(e=>e.frontFace.name).join(", "));function w(){navigator.mediaDevices.getUserMedia(k).then(e=>{t.value&&(t.value.srcObject=e,n=e)}).catch(e=>{console.error("Nelze z\xEDskat p\u0159\xEDstup k videu z kamery:",e)})}function C(){if(a.value&&t.value){a.value.width=t.value.videoWidth,a.value.height=t.value.videoWidth;const e=a.value.getContext("2d");return e?(e.filter="grayscale(100%)",e):(console.error("Nelze z\xEDskat kontext pro kreslen\xED na pl\xE1tno."),null)}}async function b(){if(!n||!t.value||!a.value){console.error("Video stream nen\xED dostupn\xFD.");return}try{const e=C();if(!e)return;e.drawImage(t.value,0,0,a.value.width,a.value.height),new Audio(U).play();const E=a.value.toDataURL("image/jpeg"),f=await y(E);if(!f){console.error("Cant get card from image.");return}v.addToScannedCards(f)}catch(e){alert(e)}}return w(),V(()=>{n&&n.getTracks().forEach(e=>e.stop())}),(e,D)=>(o(),g("div",I,[i("video",{ref_key:"videoRef",ref:t,autoplay:"",class:"video-scanner"},null,512),i("canvas",{ref_key:"canvasRef",ref:a,class:"hidden"},null,512),r(_,{onClick:b,round:"",size:"xl",color:"primary",icon:"camera",class:"photo-btn"}),i("div",O,W(S.value),1)]))}});var L=x(q,[["__scopeId","data-v-3d1fe85d"]]);const X=p({__name:"ScannerPage",setup(s){const n=d(!0);return(t,a)=>(o(),m(Q,{"hide-search":""},{default:u(()=>[r(F,{class:"q-pa-sm"},{default:u(()=>[r(_,{color:"primary",class:"full-width",onClick:a[0]||(a[0]=c=>n.value=!0)},{default:u(()=>[B("Open Scanner")]),_:1}),r(l(T)),n.value?(o(),g(N,{key:0},[r(_,{class:"close-btn",color:"primary",round:"",flat:"",icon:"arrow_back_ios",size:"xl",onClick:a[1]||(a[1]=c=>n.value=!1)}),r(l(L))],64)):P("",!0)]),_:1})]),_:1}))}});var ae=x(X,[["__scopeId","data-v-57aceb0c"]]);export{ae as default};
