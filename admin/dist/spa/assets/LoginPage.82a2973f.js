import{a as U,b as K,Q as M}from"./useNotify.5b600000.js";import{u as N,b as T,M as $,c as W}from"./MainHeader.ed1d9488.js";import{c as b,r as E,a2 as H,v as G,x as Y,C as J,h as q,d as x,g as k,G as X,q as Q,D as Z,ah as ee,a as D,an as te,at as ae,aw as I,ax as R,R as A,S as z,W as j,V as p,U as d,ad as F,_ as oe,u as y,a8 as re,aa as O}from"./index.4fb94c5d.js";import{q as ne}from"./query.303e0433.js";import{j as se,u as ue,a as ie,Q as B}from"./InputSearch.fe9a552f.js";var le=b({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(t,{slots:s,emit:r}){const m=k(),a=E(null);let n=0;const c=[];function v(e){const f=typeof e=="boolean"?e:t.noErrorFocus!==!0,g=++n,C=(o,u)=>{r("validation"+(o===!0?"Success":"Error"),u)},P=o=>{const u=o.validate();return typeof u.then=="function"?u.then(l=>({valid:l,comp:o}),l=>({valid:!1,comp:o,err:l})):Promise.resolve({valid:u,comp:o})};return(t.greedy===!0?Promise.all(c.map(P)).then(o=>o.filter(u=>u.valid!==!0)):c.reduce((o,u)=>o.then(()=>P(u).then(l=>{if(l.valid===!1)return Promise.reject(l)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return g===n&&C(!0),!0;if(g===n){const{comp:u,err:l}=o[0];if(l!==void 0&&console.error(l),C(!1,u),f===!0){const V=o.find(({comp:L})=>typeof L.focus=="function"&&X(L.$)===!1);V!==void 0&&V.comp.focus()}}return!1})}function i(){n++,c.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function h(e){e!==void 0&&Q(e);const f=n+1;v().then(g=>{f===n&&g===!0&&(t.onSubmit!==void 0?r("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function w(e){e!==void 0&&Q(e),r("reset"),Z(()=>{i(),t.autofocus===!0&&t.noResetFocus!==!0&&_()})}function _(){se(()=>{if(a.value===null)return;const e=a.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||a.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||a.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(a.value.querySelectorAll("[tabindex]"),f=>f.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}H(ee,{bindComponent(e){c.push(e)},unbindComponent(e){const f=c.indexOf(e);f>-1&&c.splice(f,1)}});let S=!1;return G(()=>{S=!0}),Y(()=>{S===!0&&t.autofocus===!0&&_()}),J(()=>{t.autofocus===!0&&_()}),Object.assign(m.proxy,{validate:v,resetValidation:i,submit:h,reset:w,focus:_,getValidationComponents:()=>c}),()=>q("form",{class:"q-form",ref:a,onSubmit:h,onReset:w},x(s.default))}}),de=b({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(t,{slots:s}){const r=D(()=>`q-card__section q-card__section--${t.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>q(t.tag,{class:r.value},x(s.default))}}),ce=b({name:"QCard",props:{...ue,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(t,{slots:s}){const{proxy:{$q:r}}=k(),m=ie(t,r),a=D(()=>"q-card"+(m.value===!0?" q-card--dark q-dark":"")+(t.bordered===!0?" q-card--bordered":"")+(t.square===!0?" q-card--square no-border-radius":"")+(t.flat===!0?" q-card--flat no-shadow":""));return()=>q(t.tag,{class:a.value},x(s.default))}});const fe="1.0.8";function me(){const{replace:t,currentRoute:s}=te();function r(){t({name:"index",query:{query:s.value.query.query}})}return{redirectToDashboard:r}}function ve(){const{notifyWelcome:t,notifyError:s}=U(),{redirectToDashboard:r}=me();async function m(a){try{const n=await ae("/api/authorization/login",a);return n!=null&&n.token?(I.set(R,n.token,{expires:7}),t("Welcome to the dungeon"),r()):s("Login failed"),n}catch{s("Login failed")}}return K({mutationFn:m})}const pe={class:"flex row justify-between items-center q-mt-md"},_e={class:"text-caption"},ge=A({__name:"LoginForm",setup(t){const{mutate:s,isLoading:r}=ve(),a=E({username:"",password:""});function n(){s(a.value)}return(c,v)=>(z(),j(ce,{flat:"",bordered:"",class:"login-card q-pa-md q-mx-sm"},{default:p(()=>[d(de,null,{default:p(()=>[d(le,{onSubmit:n},{default:p(()=>[d(B,{modelValue:a.value.username,"onUpdate:modelValue":v[0]||(v[0]=i=>a.value.username=i),label:"Username",dense:"","lazy-rules":"",rules:[i=>!!i||"Username is required"]},null,8,["modelValue","rules"]),d(B,{modelValue:a.value.password,"onUpdate:modelValue":v[1]||(v[1]=i=>a.value.password=i),label:"Password","lazy-rules":"",dense:"",autocomplete:"on",color:"primary",rules:[i=>!!i||"Password is required"],type:"password"},null,8,["modelValue","rules"]),F("div",pe,[F("div",_e,"v"+oe(y(fe)),1),d(re,{type:"submit",color:"primary",label:"Login",loading:y(r)},null,8,["loading"])])]),_:1})]),_:1})]),_:1}))}});var ye=O(ge,[["__scopeId","data-v-d3b6def2"]]);const be=A({__name:"LoginPage",setup(t){const{setDrawer:s}=N();function r(){s(!1),I.remove(R),ne.clear()}return r(),(m,a)=>(z(),j(T,{view:"lHh Lpr fff"},{default:p(()=>[d($,{"empty-header":""}),d(W,null,{default:p(()=>[d(M,{class:"window-width row justify-center items-center"},{default:p(()=>[d(y(ye))]),_:1})]),_:1})]),_:1}))}});var Pe=O(be,[["__scopeId","data-v-c02b316c"]]);export{Pe as default};
