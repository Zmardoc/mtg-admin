import{a as U,b as j,Q as K}from"./useNotify.7010450b.js";import{u as M,b as N,M as T,c as $}from"./MainHeader.9abf8a2c.js";import{c as y,r as F,a2 as W,v as H,x as G,C as Y,h as b,d as q,g as B,G as J,q as L,D as X,ah as Z,a as E,an as ee,at as te,aw as k,ax as D,R as I,S as R,W as A,V as p,U as d,ad as ae,a8 as oe,u as z,aa as O}from"./index.366256f9.js";import{q as re}from"./query.f9a51d04.js";import{j as ne,u as se,a as ue,Q}from"./InputSearch.f8709434.js";var ie=y({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(t,{slots:s,emit:r}){const m=B(),a=F(null);let n=0;const c=[];function v(e){const f=typeof e=="boolean"?e:t.noErrorFocus!==!0,g=++n,S=(o,u)=>{r("validation"+(o===!0?"Success":"Error"),u)},C=o=>{const u=o.validate();return typeof u.then=="function"?u.then(l=>({valid:l,comp:o}),l=>({valid:!1,comp:o,err:l})):Promise.resolve({valid:u,comp:o})};return(t.greedy===!0?Promise.all(c.map(C)).then(o=>o.filter(u=>u.valid!==!0)):c.reduce((o,u)=>o.then(()=>C(u).then(l=>{if(l.valid===!1)return Promise.reject(l)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return g===n&&S(!0),!0;if(g===n){const{comp:u,err:l}=o[0];if(l!==void 0&&console.error(l),S(!1,u),f===!0){const P=o.find(({comp:V})=>typeof V.focus=="function"&&J(V.$)===!1);P!==void 0&&P.comp.focus()}}return!1})}function i(){n++,c.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function x(e){e!==void 0&&L(e);const f=n+1;v().then(g=>{f===n&&g===!0&&(t.onSubmit!==void 0?r("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function h(e){e!==void 0&&L(e),r("reset"),X(()=>{i(),t.autofocus===!0&&t.noResetFocus!==!0&&_()})}function _(){ne(()=>{if(a.value===null)return;const e=a.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||a.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||a.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(a.value.querySelectorAll("[tabindex]"),f=>f.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}W(Z,{bindComponent(e){c.push(e)},unbindComponent(e){const f=c.indexOf(e);f>-1&&c.splice(f,1)}});let w=!1;return H(()=>{w=!0}),G(()=>{w===!0&&t.autofocus===!0&&_()}),Y(()=>{t.autofocus===!0&&_()}),Object.assign(m.proxy,{validate:v,resetValidation:i,submit:x,reset:h,focus:_,getValidationComponents:()=>c}),()=>b("form",{class:"q-form",ref:a,onSubmit:x,onReset:h},q(s.default))}}),le=y({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(t,{slots:s}){const r=E(()=>`q-card__section q-card__section--${t.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>b(t.tag,{class:r.value},q(s.default))}}),de=y({name:"QCard",props:{...se,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(t,{slots:s}){const{proxy:{$q:r}}=B(),m=ue(t,r),a=E(()=>"q-card"+(m.value===!0?" q-card--dark q-dark":"")+(t.bordered===!0?" q-card--bordered":"")+(t.square===!0?" q-card--square no-border-radius":"")+(t.flat===!0?" q-card--flat no-shadow":""));return()=>b(t.tag,{class:a.value},q(s.default))}});function ce(){const{replace:t,currentRoute:s}=ee();function r(){t({name:"index",query:{query:s.value.query.query}})}return{redirectToDashboard:r}}function fe(){const{notifyWelcome:t,notifyError:s}=U(),{redirectToDashboard:r}=ce();async function m(a){try{const n=await te("/api/authorization/login",a);return n!=null&&n.token?(k.set(D,n.token,{expires:7}),t("Welcome to the dungeon"),r()):s("Login failed"),n}catch{s("Login failed")}}return j({mutationFn:m})}const me={class:"flex row reverse"},ve=I({__name:"LoginForm",setup(t){const{mutate:s,isLoading:r}=fe(),a=F({username:"",password:""});function n(){s(a.value)}return(c,v)=>(R(),A(de,{flat:"",bordered:"",class:"login-card q-pa-md q-mx-sm"},{default:p(()=>[d(le,null,{default:p(()=>[d(ie,{onSubmit:n},{default:p(()=>[d(Q,{modelValue:a.value.username,"onUpdate:modelValue":v[0]||(v[0]=i=>a.value.username=i),label:"Username",dense:"","lazy-rules":"",rules:[i=>!!i||"Username is required"]},null,8,["modelValue","rules"]),d(Q,{modelValue:a.value.password,"onUpdate:modelValue":v[1]||(v[1]=i=>a.value.password=i),label:"Password","lazy-rules":"",dense:"",autocomplete:"on",color:"primary",rules:[i=>!!i||"Password is required"],type:"password"},null,8,["modelValue","rules"]),ae("div",me,[d(oe,{type:"submit",color:"primary",label:"Login",class:"q-mt-md",loading:z(r)},null,8,["loading"])])]),_:1})]),_:1})]),_:1}))}});var pe=O(ve,[["__scopeId","data-v-4be6275a"]]);const _e=I({__name:"LoginPage",setup(t){const{setDrawer:s}=M();function r(){s(!1),k.remove(D),re.clear()}return r(),(m,a)=>(R(),A(N,{view:"lHh Lpr fff"},{default:p(()=>[d(T,{"empty-header":""}),d($,null,{default:p(()=>[d(K,{class:"window-width row justify-center items-center"},{default:p(()=>[d(z(pe))]),_:1})]),_:1})]),_:1}))}});var we=O(_e,[["__scopeId","data-v-c02b316c"]]);export{we as default};
