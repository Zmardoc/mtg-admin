import{a7 as z,r as c,R as _,a as m,S as i,T as v,_ as x,ar as R,a6 as W,ad as u,U as s,a8 as l,aa as g,W as B,V as d,Z as N,u as P,au as V,X as $}from"./index.23daa906.js";import{a as F,Q as T}from"./QPage.94403c46.js";import j from"./MainLayout.c717f65a.js";import"./query.9b51e0cf.js";import"./MainHeader.f7389370.js";import"./InputSearch.65894d96.js";const h=z("scanner",()=>{const r=c([]);function t(n){r.value=[...new Set([...r.value,n])]}return{scannedCards:r,addToScannedCards:t}}),M={class:"text-white"},Q=_({__name:"ScannerResults",setup(r){const t=h(),n=m(()=>t.scannedCards.map(a=>a.frontFace.name).join(", "));return(a,o)=>(i(),v("div",M,"Karty: "+x(n.value),1))}});var U="/assets/beep.8f62dcd8.mp3";function A(r){return R("/api/ocr/scan",{imageBase64:r})}function I(){return F({mutationFn:A})}const O={class:"scanner-window"},q={class:"scanned-text text-white"},K=_({__name:"ScannerWindow",setup(r){let t=null;const n=c(null),a=c(null),o=/(android|iphone|ipad)/i.test(navigator.userAgent),{mutateAsync:y}=I(),p=h(),S={audio:!1,video:o?{facingMode:{exact:"environment"}}:!0},k=m(()=>p.scannedCards.map(e=>e.frontFace.name).join(", "));function w(){navigator.mediaDevices.getUserMedia(S).then(e=>{n.value&&(n.value.srcObject=e,t=e)}).catch(e=>{console.error("Nelze z\xEDskat p\u0159\xEDstup k videu z kamery:",e)})}function C(){if(a.value&&n.value){a.value.width=n.value.videoWidth,a.value.height=n.value.videoWidth;const e=a.value.getContext("2d");return e?(e.filter="grayscale(100%)",e):(console.error("Nelze z\xEDskat kontext pro kreslen\xED na pl\xE1tno."),null)}}async function D(){if(!t||!n.value||!a.value){console.error("Video stream nen\xED dostupn\xFD.");return}try{const e=C();if(!e)return;e.drawImage(n.value,0,0,a.value.width,a.value.height),new Audio(U).play();const b=a.value.toDataURL("image/jpeg"),f=await y(b);if(!f){console.error("Cant get card from image.");return}p.addToScannedCards(f)}catch(e){alert(e)}}return w(),W(()=>{t&&t.getTracks().forEach(e=>e.stop())}),(e,E)=>(i(),v("div",O,[u("video",{ref_key:"videoRef",ref:n,autoplay:"",class:"video-scanner"},null,512),u("canvas",{ref_key:"canvasRef",ref:a,class:"hidden"},null,512),s(l,{onClick:D,round:"",size:"xl",color:"primary",icon:"camera",class:"photo-btn"}),u("div",q,x(k.value),1)]))}});var L=g(K,[["__scopeId","data-v-3d1fe85d"]]);const X=_({__name:"ScannerPage",setup(r){const t=c(!0);return(n,a)=>(i(),B(j,{"hide-search":""},{default:d(()=>[s(T,{class:"q-pa-sm"},{default:d(()=>[s(l,{color:"primary",class:"full-width",onClick:a[0]||(a[0]=o=>t.value=!0)},{default:d(()=>[N("Open Scanner")]),_:1}),s(P(Q)),t.value?(i(),v(V,{key:0},[s(l,{class:"close-btn",color:"primary",round:"",flat:"",icon:"arrow_back_ios",size:"xl",onClick:a[1]||(a[1]=o=>t.value=!1)}),s(L)],64)):$("",!0)]),_:1})]),_:1}))}});var ae=g(X,[["__scopeId","data-v-4595042e"]]);export{ae as default};
